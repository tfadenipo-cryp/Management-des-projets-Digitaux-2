image: python:3.13-slim

stages:
  - lint
  - typecheck
  - audit
  - test

before_script:
  - sh -c "pip install uv pip-audit"
  - sh -c "uv sync --frozen"

lint:
  stage: lint
  script:
    - sh -c "uv run ruff check src/"

typecheck:
  stage: typecheck
  script:
    - sh -c "uv run mypy src/ --ignore-missing-imports"

security-audit:
  stage: audit
  script:
    - sh -c "pip-audit"

pytest:
  stage: test
  script:
    - sh -c "uv run pytest tests/"