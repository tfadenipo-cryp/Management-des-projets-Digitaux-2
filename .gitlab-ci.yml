stages:
  - lint
  - typecheck
  - audit
  - test

# Lint
lint:
  stage: lint
  image: python:3.13-slim
  before_script:
  - $env:Path = "$env:Path;C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.12_3.12.2800.0_x64__qbz5n2kfra8p0\Scripts\;C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.12_3.12.2800.0_x64__qbz5n2kfra8p0\"
  - python -m pip install --upgrade pip
  - python -m pip install uv
  - python -m uv sync --frozen

  script:
  - uv run ruff check
    


# Type checking
typecheck:
  stage: typecheck
  image: python:3.13-slim
  script: 
    - uv install --no-root
    - uv mypy src

# Tests unitaires
pytest:
  stage: test
  image: python:3.13-slim
  script:
    - uv install --no-root
    - uv pytest

# Audit de sécurité
security-audit:
  stage: audit
  image: python:3.13-slim
  script:
    - uv export -f requirements.txt --without-hashes -o /tmp/req.txt
    - uv pip-audit -r /tmp/req.txt
